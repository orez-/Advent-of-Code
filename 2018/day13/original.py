file = r"""
                                                     /------------------------------------------------------\                  /---------------\
  /--------------------------------------------------+--------------------------------------------------\   |                  |               |
  |                                  /---------------+----------------------------------\               |   |                  |               |
  |                  /---------------+---------\     |                                  |               |   |                  |               |
  |                  |               |         |     |       /--------------------------+---------------+---+--------------\   |               |
  |                  |  /------------+---------+-----+-------+-\/-----------------------+--\            |   |              |   |               |
  |   /--------\     |  |            |         |     |       | ||                 /-----+--+------------+---+----\         |   |               |
  |   |        |     |  |            |         |     |       | ||             /---+-----+--+------------+---+----+-\       |   |               |
  |   |        |     |  |            |         |/----+-------+-++-------------+---+-----+--+------------+---+----+-+-\     |   |               |
  |   |        |     |  |         /--+---------++----+-------+-++-------------+---+-----+--+------------+---+\   | | |     |   |               |
  | /-+--------+-----+--+---------+--+----\    ||    | /-----+-++-------------+---+-----+--+-\          |   ||   | | |     |   |   /-----------+-\
  | | |        |     |  |         |  |    |    ||    | |   /-+-++-------------+---+-----+--+-+----------+---++---+-+-+-----+---+---+---------\ | |
  | | |        | /---+--+---------+--+----+----++----+-+---+\| ||             |   |     |  | |          |   ||   | | |     |   |   |         | | |
  | | |        | |   |  |    /----+--+----+----++----+-+---+++-++-------------+---+-----+--+-+----------+---++---+-+-+----\|   \---+---------+-/ |
  | | |        | |   |  |    |   /+--+----+----++----+\|   ||| ||      /------+---+-----+--+-+----------+---++---+-+-+----++-------+--\      |   |
  | | |        | |   |  |    |  /++--+----+----++----+++---+++-++------+------+---+-----+--+\|          |   ||   | | |    ||       |  |      |   ^
  | | |    /---+-+---+--+\   |  |||  |    |    ||    |||   ||| ||      |    /-+---+-----+--+++-----\    |   ||   | | |    ||       |  |      |   |
  | | |    |   | |   |  ||   |  |||  |    |    ||    |||   ||| ||      |    | |   |   /-+--+++-----+----+---++---+-+\|    ||       |  |      |   |
  | | |    |   | |   |  || /-+--+++--+----+----++----+++---+++-++------+----+-+---+---+-+--+++-----+----+---++--\| |||    ||       | /+------+---+---\
  | | |    |   | |  /+--++-+-+--+++--+----+----++--\ |||   ||| ||/-----+----+-+---+--\| |  |||     |    |   ||  || |||   /++-------+-++-----\|   |   |
  | | |    |   | |  ||  || | |  |||  |    |    ||  | |||   ||| |\+-----+----+-+---+--++-+--/||     |    |  /++--++-+++---+++-------+-++----\||   |   |
  | | |    |   | |  || /++-+-+--+++--+----+----++--+-+++---+++\| |     |    | |   |  || |   ||     |    |  |||  || |||   |||       | ||    |||   |   |
  | | |    |   | |  || ||| | |  |||  |    |    ||  | |||   ||||| |     |   /+-+---+--++-+---++-----+----+--+++--++-+++---+++-------+-++----+++--\|   |
  | | |    |   | |  || ||| | |  |||  |    |  /-++--+-+++---+++++-+-----+---++-+---+--++-+---++-----+----+--+++--++-+++--\|||       | ||    |||  ||   |
  | | |    |   | |  || ||| | |  |||  |   /+--+-++--+-+++\  ||||| |     |   || |   | /++-+---++-----+----+--+++--++-+++--++++-------+-++----+++--++\  |
  | | |  /-+---+-+--++-+++-+\|  |||  |   ||  | ||  | ||||  ||||| |     |   || |   | ||| |   ||     |    |  |||  || |||  ||||       | ||    |||  |||  |
  | | |  | |   | |  || ||| |||  |||  |   ||  | ||  | ||||  ||||| |     |   || |   | ||| |   ||     |    |  |||  || |||  ||||   /---+-++--\ |||  |||  |
  | | |  | |   | |/-++-+++-+++-\|||  |   ||  | ||/-+-++++--+++++-+-----+---++-+---+-+++-+---++-----+----+--+++--++-+++\ ||||   |   | ||  | |||  |||  |
  | | |  | |   | || || ||| ||| ||||  |/--++--+-+++-+-++++--+++++-+-----+---++-+---+-+++-+---++-----+--\ |  |||  || |||| ||||   |   | ||  | |||  |||  |
  | | |  | |   | || || ||| ||| ||||  ||  ||  | ||| | ||\+--+++++-+-----+---++-+---+-+++-+---+/     |  | |  |||  || |||| ||v|   |   | ||  | |||  |||  |
  | | |  | | /-+-++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----+---++-+---+-+++-+---+---\  |  | |  |||  || |||| |\++---+---+-++--+-+/|  |||  |
  | | | /+-+-+-+-++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----+---++-+---+-+++-+---+---+--+--+\|  |||  || ||||/+-++---+---+-++\ | | |  |||  |
  | |/+-++-+-+-+-++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----+\  || |  /+-+++-+---+---+--+--+++--+++--++-++++++-++---+---+-+++-+-+-+-\|||  |
  | ||| || | | |/++-++-+++-+++-++++--++--++--+-+++-+-++-+--+++++-+-----++--++-+--++-+++-+---+---+--+-\|||  |||  || |||||| ||   |   | ||| | | | ||||  |
  | ||| || | | |||| || ||| ||| |||| /++--++--+-+++-+-++-+\ ||||| | /---++--++-+--++-+++-+---+---+--+-++++--+++--++-++++++\||   |   | ||| | | | ||||  |
  | ||| || | | |||| ||/+++-+++-++++-+++--++--+-+++-+\|| || ||||| | |   ||  || |  || ||| |   |   |  | ||||  |||  || |||||||||   |   | ||| | | | ||||  |
  | ||| || | | |||| |||||| ||| |||| |||  ||  | ||| |||| ||/+++++-+-+---++--++-+--++-+++-+---+---+--+-++++--+++--++-+++++++++---+---+-+++-+-+-+-++++\ |
  | ||| || | | |||\-++++++-+++-/||| |||  ||  | ||| |||| |||||||| |/+---++--++-+--++-+++-+---+---+--+-++++--+++-\|| |||||||||   |   | ||| | | | ||||| |
  | ||| || | | |||  |||||| |||  ||| |||  ||  | ||| |||| |||||||| |||   ||  || |  || ||| |   |   | /+-++++--+++-+++-+++++++++---+---+-+++-+-+-+\||||| |
  | ||| || | \-+++--++++++-+++--+++-+++--++--+-+++-++++-++++++++-+++---++--++-+--++-+++-+---+---/ || ||||  ||| ||| |||||||||   |   | ||| | | ||||||| |
  | ||| || |   |||  |||||| |||  ||| ||| /++--+-+++-++++-++++++++-+++---++--++-+--++-+++-+---+-----++-++++--+++\||| |||||||||   |   | ||| | | ||||||| |
  | ||| || |   |||  ||||\+-+++--+++-+++-+++--+-+++-++++-+++++++/ |||   ||  || |  || ||| |   |     || ||||  ||||||| |||||||||   |   | ||| | | ||||||| |
  | ||| || |   ||\--++++-+-+++--+++-+++-+++--+-+++-++++-++++/||  |||   ||  || |  || ||| |   | /---++-++++--+++++++-+++++++++--\|   | ||| | | ||||||| |
  | ||| || |   ||   |||| | |||  ||| ||| |\+--+-+++-++++-/||| ||  |||   ||  || |  || \++-+---+-+---++-++++--+++++++-+++++++++--++---+-+++-+-+-+++++/| |
  | ||| || |   ||   |||| | |||  ||| ||| | |  | ||| ||||  ||| ||  |||   ||  || |  ||  || |   | |   ||/++++--+++++++-+++++++++--++--\| ||| | | ||||| | |
  | ||| || |   ||   |||| | |||  ||| ||| | |  | ||| ||||  ||| ||  |||   ||  || |  ||  |v |   | |   |||||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
/-+-+++-++-+---++---++++-+-+++--+++-+++-+-+--+-+++-++++--+++-++--+++---++--++-+--++--++-+---+-+-\ |||||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
| | ||| || \---++---++++-//+++--+++-+++-+-+--+-+++-++++-\||| ||  \++---++--++-+--++--/| |   | | | |||||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
| | ||| ||     ||   ||||  ||||  ||| ||| | |  | ||| |||| |||| ||   ||   ||  |\-+--++---+-+---+-+-+-+/|||||  ||||||| |||||||||  ||  || ||| | | ||||| | |
| | ||| ||     ||   ||||  ||||  ||| ||| | |  | ||| |||| |||| ||   ||   ||  |  ^  ||   | | /-+-+-+-+-+++++--+++++++-+++++++++--++--++-+++-+-+-+++++\| |
| | ||| ||     ||   ||||  ||||/-+++-+++-+-+--+-+++-++++-++++-++---++---++--+--+--++--\| |/+-+-+-+-+\|||||  ||||||| |||||||||  ||  || ||| | | ||||||| |
| | ||| ||     || /-++++--+++++-+++-+++-+-+--+\||| |||| |||| ||   ||   ||  |  |  ||  || ||| | \-+-+++++++--+++++++-+++++++++--/|  || ||| | | ||||||| |
| | ||| ||     || | ||||  ||||| ||| ||| | |  ||||| |||| |||| ||   ||   ||  | /+--++--++-+++-+---+-+++++++--+++++++-+++++++++---+--++\||| | | ||||||| |
|/+-+++-++-----++-+-++++--+++++-+++-+++-+-+--+++++-++++-++++-++---++--\||  | ||  ||  || ||| |   | |||||||  ||||||| |||||||||   |  |||||| | | ||||||| |
||| ||| ||     || | ||||  ||||| ||| ||| | |  ||||| |||| |||| ||   ||/-+++--+-++--++--++-+++-+---+-+++++++--+++++++-+++++++++---+-\|||||| | | ||||||| |
||| ||| || /---++-+-++++--+++++-+++-+++\| |  ||||| |||| |||| ||   ||| |||  | ||  ||  || ||| |   | |||||||  ||||||| |||||||||   | ||||||| | | ||||||| |
||| ||| |\-+---++-+-++++--++/|| ||| ||||| |  |||\+-++++-++++-++---+++-+++--+-++--++--++-+++-+---+-+++++++--+++++++-++/||||||   | ||||||| | | ||||||| |
||| ||| |  |   || | ||||  || || ||| ||||| |  ||| | |||| |||| || /-+++-+++--+-++--++--++-+++-+---+-+++++++--+++++++\|| ||||||   | ||||||| | | ||||||| |
||| ||| |  |   || | ||||  || || ||\-+++++-+--+++-+-++++-++++-++-+-+++-+++--+-++--++--++-+++-+-<-+-+++++++--++/||||||| ||||||   | ||||\++-+-+-+++++++-/
||| ||| |  |   || | ||||  || || ||  ||||| |  ||| | |||| |||| || | ||| |||/-+-++--++--++-+++\|   | |||||||  || ||||||| ||||||   | |||| || | | |||||||
||| ||| |  |  /++-+-++++--++-++-++--+++++-+--+++-+-++++-++++-++-+-+++-++++-+-++--++\ || |||||   | |||||||  || ||||||| ||||||   | |||| || | | |||||||
||| ||| |  |  ||| | ||||  || || ||  ||||| |  ||| | |||| |||| || | ||| |||| | ||  ||| || |||||   | ||||||| /++-+++++++-++++++---+-++++-++-+-+-+++++++-\
||| ||\-+--+--+/| | ||||  || || ||  ||||| |  ||| | |||| |||| || | ||| |||| | ||  ||| || |||||   | ||||||| ||| ||||||| ||||||   | ||\+-++-+-+-++++/|| |
||| ||  |  |  | | \-++++--++-++-++--+++++-+--+/| | |||| |||| || | ||| |||| | ||  ||| || |||||   | ||||||| ||| ||||||| ||||||   | || | || | | |||| || |
||| ||  |  |  | |   ||||  || || ||  ||||| |  | | | |||| |||| || | ||| |||| | \+--+++-++-+++++---+-+++++++-+++-+++++++-++++++---+-++-/ || | | |||| || |
||v \+--+--+--+-+---++++--++-++-++--+++++-/  | | | |||| |||| || | ||| |||| |  |  \++-++-+++++---+<+++++++-+++-+++++++-++++++---+-++---++-+-+-++/| || |
|||  \--+--+--+-+---++++--++-++-++--+++++----+-+-+-++++-++++-++-+-+++-++/| |  |   || || |||||   | ||||||| ||| ||||||| ||||||   | ||   || | | || | || |
|||     |  |  | |   ||||  || || ||  |||||    | | | |||| |||| || | ||| || | |  |/--++-++-+++++---+-+++++++-+++-+++++++-++++++---+-++\  || | | || | || |
|||     |  |  | |   ||||  || || ||  |||||    | | | |||| |||| || | ||| || | |  \+--++-++-+++++---+-+++++++-+++-+++++/| ||||||   | |||  || | | || | || |
|||     |  |  | |   ||||  || || ||  |||||    | | | |||| |||| || \-+++-++-+-+---+--++-++-+++++---+-+++++++-+++-++++/ | ||||||   | |||  || | | || | || |
|||     |  | /+-+---++++--++-++-++--+++++----+-+-+\|||| |||| ||   ||| || | |   |  || || |||||   | ||||||| ||| ||||  | ||||||   | |||  || | | || | || |
||| /---+--+-++-+---++++--++-++\||  |||||    | | |||||| |||| || /-+++-++-+-+\  |  || || |||||  /+-+++++++-+++-++++-\| ||||||   | |||  || | | || | || |
||| |   |  | || |   ||||  || |||||  |||||    | | |||||| |||| || | ||| || | ||  |  || |\-+++++--++-+++++++-+++-++++-+/ ||||||   | |||  || | | || | || |
||| |   |  | || |   ||||  |\-+++++--+++++----+-+-++++++-++++-++-+-+++-++-+-++--+--++-+--+++++--++-+++++++-+++-++/| |  ||||||   | |||  || | | || | || |
||| |   |  | || |   ||||  |  |||||/-+++++----+-+\|||||| |||| || | ||| || | ||  |  || |  |||||  ||/+++++++-+++-++-+-+--++++++---+-+++--++-+\| || | || |
||| |   | /+-++-+---++++--+--++++++-+++++----+-++++++++\|||\-++-+-+++-++-+-++--+--++-+--+++++--++++++++++-+++-++-+-+--++++++---+-+++--++-+++-/| | || |
||| |   | || || |   ||||  |  |||||| |||||/---+-++++++++++++--++\| |||/++-+-++--+--++-+--+++++--++++++++++-+++-++-+-+--++++++---+-+++--++\|||  | | || |
||| |   | || || |   ||||  |  |||||| ||||||   | ||||||||||||  |||| |||||| | ||  |  || |  |\+++--++++/||||| ||| ||/+-+--++++++\  | |||  ||||||  | | || |
||| |   | || || |   ||||  |  |||||| ||||||   | ||||||||||||  |||| |||||| | ||  |  || |  | |||  |||| |||||/+++-++++-+--+++++++--+-+++--++++++--+-+\|| |
||| |   | || || |   ||||  |  |||||| ||||||   | ||||||||||||  |||| |||||| | ||  |  || |  | |||  |||| ||||||||| |||| |  |||||||  | |||  ||||||  | |||| |
||| |   | || \+-+---++++--+--++++++-++++++---+-+++/||||||||  |||| |||||| | ||  |  || |  | |||  \+++-+++++++++-++++-/  |||||||  | |||  ||||||  | |||| |
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||| ||||||||  |||| |||||| | ||  |  \+-+--+-+++---+++-+++++++++-+++/  /-+++++++--+-+++--++++++--+-++++\|
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||| ||||||||  |||| |||||| | ||  |   | |  | |||   ||| ||||||||| |||   | |||||||  | |||  ||||||  | ||||||
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||| ||||||||  |||| |||||| | ||  |   | |  | |||   ||| |||||||\+-+++---+-+++++++--+-+++--+++++/  | ||||||
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||\-++++++++--++++-++++++-+-++--+---+-+--+-+++---+++-+++++++-+-+++---+-/||||||  | |||  |||||   | ||||||
||| |   | ||  | |   ||||  |  |||||| ||||||   | ||  ||||||||  |||| |||||| | ||  |   | |  | ||| /-+++-+++++++-+-+++---+--++++++--+-+++-\|||||   | ||||||
||| |   | ||  | |   ||||  |  |||||| |\++++---+-++--++++++++--++++-++++++-+-++--+---+-+--/ ||| | ||| ||||||| | |||   |  ||^|||  | ||| ||||||   | ||||||
||| |   | ||  | |   ||||  \--++++++-+-++++---+-++--+++++/||  |||| |||||| | ||  |   | |    ||| | ||| \++++++-+-+++---+--++++++--+-+/| ||||||   | ||||||
||| |   | ||  | |/--++++-----++++++-+-++++\  | ||  ||||| ||  |||| |||||| | ||  |   | |    ||| | |||  |||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |   | ||  | ||  ||||     |||||| | |||||  | ||  ||||| ||  |||| |||||| | ||  |   | |    ||| | |||  |||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  /+-++--+-++--++++-----++++++-+-+++++--+-++--+++++-++--++++-++++++-+-++--+---+-+\   ||| | |||  |||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  | \+--++++-----++++++-+-+++++--+-++--+++++-++--++++-++++++-+-++--+---+-++---+++-+-+++--/||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  |  |  ||||     |||||| | |||||  | ||  ||||| || /++++-++++++-+-++--+---+-++---+++\| |||   ||||| | |||   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  |  | /++++-----++++++-+-+++++--+-++--+++++-++-+++++-++++++-+-++--+---+-++---+++++-+++--\||||| | ||v   |  ||||||  | | | ||||||   | ||||||
||| |  || ||  |  | |||||     |||||| | |||||  | ||  ||||| || ||||| |||||| | \+--+---+-++---+++++-+++--++++++-+-+++---+--++++++--+-+-+-++++++---+-/|||||
||| |  || ||  |  | |||||     |||||| | |||||  | ||  ||||| |\-+++++-++++++-+--+--+---+-++---+++++-+++--++++++-+-+++---+--++++++--+-+-+-++++++---+--++/||
||| |  || ||  |  | |||||     |||||| | |||||  | ||  ||||| |  ||||| |||||\-+--+--+---+-++---+++++-+++--++++++-+-+++---+--++++++--+-+-+-+/||||   |  || ||
||| |  || ||/-+--+-+++++----\|||||| | |||||  | ||  ||||| |  ||||| |\+++--+--+--+---+-++---+++++-+++--++++++-+-+++---+--++/|||  | | | | ||||   |  || ||
||| | /++-+++-+--+-+++++----+++++++-+-+++++--+-++--+++++-+--+++++-+-+++--+--+--+---+-++---+++++-+++-\|||||| | |||   |  || |||  | | | | ||||   |  || ||
||| | |\+-+++-+--+-+++++----+++++++-+-+++++--+-++--+++++-+--+++++-+-+++--+--+--+---+-+/   ||||| ||| ||||||| |/+++---+--++-+++--+-+-+-+-++++-\ |  || ||
||| | | | ||| |  | |\+++----+++++++-+-+++++--+-++--/|||| |  ||||| | |||  |  |  |   | |    ||||| ||| ||||||| |||||   |  || |||  | | | | |||| | |  || ||
||\-+-+-+-+++-+--+-+-+++----+++++++-+-+++++--+-++---++++-+--+++++-+-+++--+--+--+>--+-+----+++++-+++-++++/|| |||||   |  || |||  | | | | |||| | |  || ||
||  | | | ||| |  | | |||    ||||||| | |||||  | ||   |||| |  ||||| | |||  |  |/-+---+-+----+++++-+++-++++-++-+++++---+--++-+++--+-+-+-+-++++-+-+-\|| ||
|| /+-+-+-+++-+--+-+-+++----+++++++-+-+++++--+-++---++++-+-\|\+++-+-+++--+--++-+---+-+----+++++-+++-++++-++-+++++---+--++-+/|  | | | | |||| | | ||| ||
|| || | \-+++-+--+-+-+++----+++++++-+-+++++--+-++---++++-+-++-+++-+-+++--+--++-+---+-+----+++++-+++-+++/ || |||||   |  || | |  | | | | |||| | | ||| ||
|| || |   ||| |  | | \++----+++++++-+-+++++--+-/|   |\++-+-++-+++-+-+++--+--++-+---+-+----+++++-+++-+++--++-/||||   |  |^ | |  | | | | |||| | | ||| ||
|| ||/+---+++-+--+-+--++----+++++++-+-+++++--+--+---+-++-+-++-+++-+-+++--+--++-+---+-+----+++++-+++\|||  ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |  ||    ||||||| | \++++--+--+---+-++-+-++-+++-+-+++--+--++-+---+-+----+++++-++++++/  ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |  ||    |||||\+-+--++++--+--+---+-/| | |v ||| | |||  |  || |   | |    ||||| ||||||   ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |  \+----+++++-+-+--++++--+--+---/  | | || ||| | |||  |  || |   | |    ||||| ||||||   ||  ||||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    ||||| | |  |\++--+--+------+-+-++-+++-+-+++--+--++-+---+-+----+++++-++++++---++--+/||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    ||||\-+-+--+-++--+--+------+-+-++-+++-+-+++--+--++-+---+-+----++/|| ||||||   ||  | ||   |  || | |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    |\++--+-+--+-++--+--+------+-+-++-+++-+-+++--+--++-+---+-+----++-++-++++++---++--+-++---+--++-/ |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   |    | ||  | |  | ||  |  |      | | || ||| | |||  |  || |   | |    || || ||||||   ||  | ||   |  ||   |  | | | | |||| | | ||| ||
|| ||||   ||| |  | |   \----+-++--+-+--+-++--+--+------+-+-++-/|| | |||  |/-++-+---+-+----++-++-++++++---++--+-++---+--++---+--+-+-+\| |||| | | ||| ||
|| ||||   ||| |  | |        | ||  | |  | ||  |  |      | | ||  || | |||  || || |   | |    || || ||||||   ||  | ||   |  ||   |  \-+-+++-++/| | | ||| ||
|| ||||   ||| |  | |        | ||  | |  | ||  \--+------+-+-++--++-+-+++--++-++-+---+-+----++-++-++++++---++--+-++---+--+/   |    | ||| || | | | ||| ||
|| |||\---+++-+--+-+--------+-++--+-+--+-++-----+------+-+-++--++-+-+++--++-++-+---+-+----++-++-++++/|   ||  | |\---+--+----/    | ||| || | | | ||| ||
|| |||    ||| |  | |        | ||  | |  | ||     |      | | ||  || | ||| /++-++-+---+\|    || || |||| |   ||  \-+----+--+------>--+-+++-++-+-/ | ||| ||
|| |||    ||| \--+-+--------+-++--+-+--+-++-----+------+-+-++--++-+-+++-+++-++-+---/||    || || |||| |   \+----+----+--+---------+-+++-++-+---+-+/| ||
|| |||    |||    | |        | ||  | |  | ||     |      | | ||  || | ||| ||| || |    ||    || || |||| |    |    |    |  |         | ||| || |   | | | ||
|| |\+----+++----+-+--------+-+/  | |  | ||  /--+------+-+-++--++-+-+++-+++-++-+---\||    || || |||| |    |    |    |  |         | ||| || |   | | | ||
|| | |    |||    | |        | |   | |  | ||  |  |      | | |\--++-+-+++-+++-++-+---+++----++-/| |||| |    |    |    |  |         | ||| || |   | | | ||
|| | |    |||    | |   /----+-+---+-+--+-++-\|  |      | | |   || | ||| ||| || |   |||    ||  | |||| |    |    |    \--+---------+-+++-++-+---+-+-+-/|
|| | |    ||| /--+-+---+----+-+---+-+-\| || ||  |      | | |   |\-+-+++-+++-/| |   |||    ||  | |||| |    \----+-------+---------+-+++-++-+---+-+-+--/
|| | |    ||| |  | |   |    | |   | | || || ||  |      | | |   |  | ||| |||  | |   |||    ||  | |||| |         |       \---------+-+++-/| |   | | |
|| | |  /-+++-+--+-+---+----+-+---+-+-++-++-++--+------+-+-+---+--+-+++-+++--+-+---+++---\||  | |||| |         |                 | |||  | |   | | |
|| | |  | ||| |  | |   |    | |   | | || || ||  |      | | |   |  \-+++-+++--+-+---+++---+++--+-++++-+---------/                 | |||  | |   | | |
|| | |  | ||| |  | |   |    | |   | | || || ||  |      | | |   |    ||| |||  \-+---+++---+++--+-++++-+---------------------------+-+++--+-+---+-/ |
|| | |  | |\+-+--+-+---+----+-+---+-+-+/ || ||  |      | | |   |    ||| |||    |   |||   |\+--+-++++-+---------------------------+-+++--+-+---+---/
|| | |  | | | |  | |   |    | |   | | |  || ||  |      | | |   |    ||| |||    \---+++---+-+--+-++++-+---------------------------+-/||  | |   |
|| | |  | | | |  | |   |    | |   | | |  |v |\--+------+-+-+---+----+++-+++--------/||   | |  \-++++-+---------------------------+--+/  | |   |
\+-+-+--+-+-+-+--+-+---+----+-+---+-+-+--++-+---+------+-+-+---+----+++-+++---------++---+-+----/||| |                           |  |   | |   |
 | | |  | | | |  | |   |    | |   | | |  || |   |      | | |   |    \++-+++---------++---+-+-----+++-+---------------------------/  |   | |   |
 | | |  | | | |  | |   \----+-+---+-+-+--++-/   |      | | |   |     || |||         ||   | |     \++-+------------------------------+---+-/   |
 | | |  | | | |  \-+--------+-+---+-+-+--+/     |      | | |   |     || |||         ||   | |      || |                              |   |     |
 | | |  | | | |    |        | |   | | |  |      |      | | |   |     || |||         ||   | |      \+-+------------------------------+---+-----/
 | | |  | | \-+----+--------/ |   \-+-+--+------/ /----+-+-+---+-----++-+++---------++---+-+-------+-+-\                            |   |
 | | |  | |   |    |          |     | |  \--------+----+-+-+---/     || |||         ||   | |       | | |                            |   |
 | \-+--+-+---+----+----------+-----+-+-----------+----+-+-/         || |||         ||   | |       | | |                            |   |
 |   |  | |   |    |          |     \-+-----------+----+-/           || \++---------/|   | |       | | |                            |   |
 |   |  | |   |    |          \-------+-----------+----+-------------++--++----------/   | |       | | |                            |   |
 |   |  | |   |    \------------------+>----------+----+-------------++--++----------->--+-+-------+-/ |                            |   |
 |   |  | \---+-----------------------+-----------+----/             ||  \+--------------+-/       |   |                            |   |
 |   |  \-----+-----------------------+-----------+------------------++---+--------------/         |   |                            |   |
 |   |        \-----------------------/           |                  ||   \------------------------+---+----------------------------/   |
 |   \--------------------------------------------+------------------++----------------------------/   |                                |
 |                                                |                  \+------------------------------>-+--------------------------------/
 \------------------------------------------------+-------------------/                                |
                                                  \----------------------------------------------------/
""".split('\n')
file.pop(0)


# ^>v<
class Cart:
    def __init__(self, symbol):
        self.facing = '^>v<'.index(symbol)
        self.decisions = 0

    def turn(self):
        if self.decisions == 0:
            self.facing = (self.facing - 1) % 4
        elif self.decisions == 2:
            self.facing = (self.facing + 1) % 4
        self.decisions = (self.decisions + 1) % 3

    def move(self, tile):
        if tile == '/':
            self.facing ^= 1
        elif tile == '\\':
            self.facing = 3 - self.facing
        elif tile == '+':
            self.turn()
        else:
            assert tile in '-|', repr(tile)

        # y,x
        if self.facing == 0:
            return -1, 0
        elif self.facing == 1:
            return 0, 1
        elif self.facing == 2:
            return 1, 0
        elif self.facing == 3:
            return 0, -1


def part1(file):
    carts = {}
    board = []
    for y, row in enumerate(file):
        for x, elem in enumerate(row):
            if elem in '^>v<':
                carts[y, x] = Cart(elem)
        board.append(row.replace('>', '-').replace('<', '-').replace('^', '|').replace('v', '|'))

    while True:
        for (y, x), cart in sorted(carts.items()):
            dy, dx = cart.move(board[y][x])
            del carts[y, x]
            new_coord = y + dy, x + dx
            if new_coord in carts:
                return new_coord[::-1]
            carts[new_coord] = cart


def part2(file):
    carts = {}
    board = []
    for y, row in enumerate(file):
        for x, elem in enumerate(row):
            if elem in '^>v<':
                carts[y, x] = Cart(elem)
        board.append(row.replace('>', '-').replace('<', '-').replace('^', '|').replace('v', '|'))

    while True:
        for (y, x), cart in sorted(carts.items()):
            if (y, x) not in carts:  # mighta died already
                continue
            dy, dx = cart.move(board[y][x])
            del carts[y, x]
            new_coord = y + dy, x + dx
            if new_coord in carts:
                del carts[new_coord]
            else:
                carts[new_coord] = cart
        if len(carts) == 1:
            (y, x), = tuple(carts)
            return x, y


print(part1(list(file)))
print(part2(list(file)))
